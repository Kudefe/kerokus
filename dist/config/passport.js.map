{"version":3,"sources":["../../server/config/passport.js"],"names":["LocalStrategy","require","Strategy","module","exports","passport","use","username","password","done","query","findOne","err","user","message","compare","isMatch","serializeUser","id","deserializeUser","findById"],"mappings":";;AACA;;;;AACA;;;;AACA;;;;;;AAHA,IAAMA,gBAAgBC,QAAQ,gBAAR,EAA0BC,QAAhD;;;AAKAC,OAAOC,OAAP,GAAiB,UAASC,QAAT,EAAkB;AACjC;AACA;AACAA,WAASC,GAAT,CAAa,IAAIN,aAAJ,CAAkB,UAASO,QAAT,EAAmBC,QAAnB,EAA6BC,IAA7B,EAAkC;AAC/D;AACA,QAAIC,QAAQ,EAACH,UAASA,QAAV,EAAZ;AACA,oBAAMI,OAAN,CAAcD,KAAd,EAAqB,UAASE,GAAT,EAAcC,IAAd,EAAmB;AACtC,UAAGD,GAAH,EAAQ,MAAMA,GAAN;AACR,UAAG,CAACC,IAAJ,EAAS;AACP,eAAOJ,KAAK,IAAL,EAAW,KAAX,EAAkB,EAACK,SAAS,eAAV,EAAlB,CAAP;AACD;;AAED;AACA,yBAAOC,OAAP,CAAeP,QAAf,EAAyBK,KAAKL,QAA9B,EAAwC,UAASI,GAAT,EAAcI,OAAd,EAAsB;AAC5D,YAAGJ,GAAH,EAAQ,MAAMA,GAAN;AACR,YAAGI,OAAH,EAAW;AACT,iBAAOP,KAAK,IAAL,EAAWI,IAAX,CAAP;AACD,SAFD,MAEO;AACL,iBAAOJ,KAAK,IAAL,EAAW,KAAX,EAAkB,EAACK,SAAS,gBAAV,EAAlB,CAAP;AACD;AACF,OAPD;AAQD,KAfD;AAgBD,GAnBY,CAAb;;AAqBAT,WAASY,aAAT,CAAuB,UAASJ,IAAT,EAAeJ,IAAf,EAAqB;AAC1CA,SAAK,IAAL,EAAWI,KAAKK,EAAhB;AACD,GAFD;AAGAb,WAASc,eAAT,CAAyB,UAASD,EAAT,EAAaT,IAAb,EAAmB;AAC1C,oBAAMW,QAAN,CAAeF,EAAf,EAAmB,UAASN,GAAT,EAAcC,IAAd,EAAoB;AACrCJ,WAAKG,GAAL,EAAUC,IAAV;AACD,KAFD;AAGD,GAJD;AAKD,CAhCD","file":"passport.js","sourcesContent":["const LocalStrategy = require('passport-local').Strategy\r\nimport Admin from './../models/admin'\r\nimport config from './database'\r\nimport bcrypt from 'bcryptjs'\r\n\r\nmodule.exports = function(passport){\r\n  //TODO a√±adir email en login strategy. Remover username.\r\n  // Local Strategy\r\n  passport.use(new LocalStrategy(function(username, password, done){\r\n    // Match Username\r\n    let query = {username:username};\r\n    Admin.findOne(query, function(err, user){\r\n      if(err) throw err;\r\n      if(!user){\r\n        return done(null, false, {message: 'No user found'});\r\n      }\r\n\r\n      // Match Password\r\n      bcrypt.compare(password, user.password, function(err, isMatch){\r\n        if(err) throw err;\r\n        if(isMatch){\r\n          return done(null, user);\r\n        } else {\r\n          return done(null, false, {message: 'Wrong password'});\r\n        }\r\n      });\r\n    });\r\n  }));\r\n\r\n  passport.serializeUser(function(user, done) {\r\n    done(null, user.id);\r\n  });\r\n  passport.deserializeUser(function(id, done) {\r\n    Admin.findById(id, function(err, user) {\r\n      done(err, user);\r\n    });\r\n  });\r\n}\r\n"]}